/******************************************************************************/
/****               Generated by IBExpert 17.3.2006 23:53:34               ****/
/******************************************************************************/

SET SQL DIALECT 3;

SET NAMES NONE;

CREATE GENERATOR GN_SYCRIGHTPOOL;

SET TERM ^ ;


CREATE TRIGGER TR_SYCRIGHTPOOL FOR SY_CRIGHTPOOL
ACTIVE BEFORE INSERT OR UPDATE POSITION 0
AS
  declare variable a_iMaxPool INTEGER ;
  -- ??? neexistuje "old.sloupec"?
begin
  -- max hodnota poolu neni vyplnena
  if (new.sycrightpool_imax is null ) then
    begin
      -- vytazeni hodnoty z DB_CONFIG
      SELECT SYTDBCONFIG_IVALUE
        FROM SY_TDBCONFIG c,SY_CDBCONFIGTYPE t
       WHERE t.SYCDBCONFIGTYPE_PK = c.sytdbconfig_ftype AND
             t.sycdbconfigtype_vname = '__MAX_POOL'
        INTO a_iMaxPool;

      if (a_iMaxPool is null) then
        a_iMaxPool = 1000;

      new.sycrightpool_imax = new.sycrightpool_imin + a_iMaxPool;
    END

    --kontrola ny vyplneny PK
    if (new.sycrightpool_pk is null) then
      new.sycrightpool_pk = GEN_ID(gn_sycrightpool,1);
end
^


SET TERM ; ^

$(document).ready(function(){drawmonth=(new Date).getMonth();CalendarInit($("#datepicker"),DaySelect);HighlightAllInvalInputs($("body"));$("body").on("change",'select[name="languagesel"]',function(){ChangeLanguage($("#datepicker"))});$("body").on("click",".daycourses .course:not(.disabled)",function(){SelectCourse($(this).attr("pk"))});SelectCourseCalendByPK($(".coursechoose").attr("pk"));setInterval(UpdateActStatus,5E3)});function DaySelect(b,a,c){b.datepicker("setDate",a);LoadCoursesonDay(a);"function"==typeof c&&c()}var CalendarDataXML="",drawmonth=0;function CalendarInit(b,a,c){$.datepicker.regional.cs={closeText:"Cerrar",prevText:"<",nextText:">",currentText:"Hoy",monthNames:"Leden \u00danor B\u0159ezen Duben Kv\u011bten \u010cerven \u010cervenec Srpen Z\u00e1\u0159\u00ed \u0158\u00edjen Listopad Prosinec".split(" "),monthNamesShort:"Le \u00dan B\u0159 Du Kv \u010cn \u010cc Sr Z\u00e1 \u0158\u00ed Li Pr".split(" "),dayNames:"Ned\u011ble Pond\u011bl\u00ed \u00dater\u00fd St\u0159eda \u010ctvrtek P\u00e1tek Sobota".split(" "),dayNamesShort:"Ne Po \u00dat St \u010ct P\u00e1 So".split(" "),dayNamesMin:"Ne Po \u00dat St \u010ct P\u00e1 So".split(" "),weekHeader:"Sm",dateFormat:"dd.mm.yy",firstDay:1,isRTL:!0,showMonthAfterYear:!1,yearSuffix:"",showOtherMonths:!0,selectOtherMonths:!0,numberOfMonths:2,stepMonths:1};$.datepicker.setDefaults($.datepicker.regional.cs);var d=new Date,e=d.getMonth(),f=new Date(d.getFullYear(),e-1,1);d=new Date(d.getFullYear(),e+2,0);RequestCalendarhData(!1,f,d);b.datepicker({beforeShowDay:function(a){result=[!1,""];LoadDayData(result,$(this),a);return result},onSelect:function(b,c){"function"===typeof a&&a($(this),b);c.drawMonth=drawmonth},onChangeMonthYear:function(a,b){$(".dayview").hide();$("input[name=c_selterm]").remove();var d=new Date(a,b-1,1);$(this).datepicker("setDate",d);RequestCalendarhData(!1,new Date(a,b-2,1),new Date(a,b+1,1),function(){"function"===typeof c&&c(a,b)});drawmonth=b-1}}).on("click","button.today",function(){a(b,DateToStr(new Date))})}function LoadDayData(b,a,c){a=$(CalendarDataXML).find('day[date="'+DateToStr(c)+'"]');var d=new Date;d.setHours(0,0,0,0);0<a.length&&c>=d&&(b[0]=!0)}function LoadCoursesonDay(b,a){$(".daycourses").remove();var c=$(".dayview");if(c.attr("date")!=b||a){c.attr("date",b);c.find(".conn .date").text(b+" ("+$.datepicker.formatDate("DD",StrToDate(b))+")");var d=c.find(".conn .content");d.empty();var e="";$(CalendarDataXML).find('day[date="'+b+'"]').each(function(){e+='<table class="daycourses"><thead><th>zah\u00e1jen\u00ed</th><th>jazyk</th><th>n\u00e1zev</th><th>obsazenost</th></thead><tbody>';$(this).find("course").each(function(){e+='<tr class="course'+("open"==$(this).attr("state")?"":" disabled")+'" pk="'+$(this).attr("pk")+'" title="'+("open"==$(this).attr("state")?"vybrat pro podrobnosti":"obsazeno - nelze vybrat")+'"><td class="time">'+$(this).attr("time")+'</td><td class="language">'+$(this).attr("language")+'</td><td class="name">'+$(this).attr("name")+'</td><td class="capacity">'+$(this).attr("capacity")+"</td></tr>"});e+="</tbody></table>"});d.append(e);c.slideDown(200)}}function ChangeLanguage(b){var a=b.datepicker("getDate"),c=a.getFullYear(),d=a.getMonth();$(".dayview .course.selected").attr("pk");RequestCalendarhData(!1,new Date(c,d-2,1),new Date(c,d+1,1),function(){DaySelect(b,DateToStr(a),LoadCoursesonDay(DateToStr(a),!0))})}function RequestCalendarhData(b,a,c,d){SendAjaxRequest("type=GetCalendarData&language="+$('select[name="languagesel"]').val()+"&fromdate="+DateToStr(a)+"&todate="+DateToStr(c),b,function(a){CalendarDataXML=$(a).html();"function"==typeof d&&d(a)})}function SelectCourse(b,a){SendAjaxRequest("type=SelectCourse&pk="+b,!0,function(c){$(".selected").removeClass("selected");$('.daycourses .course[pk="'+b+'"]').addClass("selected");var d=$('<div class="coursedetailview">'+$(c).find("courhtml").html()+"</div>");$(".coursedetailview").remove();d.insertAfter(".dayview");"function"==typeof a&&a(c)})}function SelectCourseCalendByPK(b){if(parseInt(b)){var a=$(CalendarDataXML).find("course[pk="+b+"]").closest("day").attr("date");0<a.length&&DaySelect($("#datepicker"),a,function(){SelectCourse(b)})}}function UpdateActStatus(){if(0<$("#datepicker").length){var b=$("#datepicker"),a=b.datepicker("getDate"),c=DateToStr(a),d=a.getFullYear();a=a.getMonth();var e="0";0<$(".daycourses .course.selected").length&&(e=$(".daycourses .course.selected").attr("pk"));RequestCalendarhData(!0,new Date(d,a-2,1),new Date(d,a+1,1),function(){DaySelect(b,c,function(){LoadCoursesonDay(c,!0);0<$('.daycourses .course[pk="'+e+'"]').length&&$('.daycourses .course[pk="'+e+'"]').addClass("selected")})})}};
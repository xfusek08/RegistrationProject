!function(d){"object"==typeof exports&&exports&&"object"==typeof module&&module&&module.exports===exports?d(require("jquery")):"function"==typeof define&&define.amd?define(["jquery"],d):d(jQuery)}(function(d){function g(b){b=b[0];return 0<b.offsetWidth&&0<b.offsetHeight}function a(b){if(b.minTime&&(b.minTime=m(b.minTime)),b.maxTime&&(b.maxTime=m(b.maxTime)),b.durationTime&&"function"!=typeof b.durationTime&&(b.durationTime=m(b.durationTime)),"now"==b.scrollDefault)b.scrollDefault=function(){return b.roundingFunction(m(new Date),b)};else if(b.scrollDefault&&"function"!=typeof b.scrollDefault){var e=b.scrollDefault;b.scrollDefault=function(){return b.roundingFunction(m(e),b)}}else b.minTime&&(b.scrollDefault=function(){return b.roundingFunction(b.minTime,b)});if("string"===d.type(b.timeFormat)&&b.timeFormat.match(/[gh]/)&&(b._twelveHourTime=!0),!1===b.showOnFocus&&-1!=b.showOn.indexOf("focus")&&b.showOn.splice(b.showOn.indexOf("focus"),1),0<b.disableTimeRanges.length){for(var f in b.disableTimeRanges)b.disableTimeRanges[f]=[m(b.disableTimeRanges[f][0]),m(b.disableTimeRanges[f][1])];b.disableTimeRanges=b.disableTimeRanges.sort(function(b,e){return b[0]-e[0]});for(f=b.disableTimeRanges.length-1;0<f;f--)b.disableTimeRanges[f][0]<=b.disableTimeRanges[f-1][1]&&(b.disableTimeRanges[f-1]=[Math.min(b.disableTimeRanges[f][0],b.disableTimeRanges[f-1][0]),Math.max(b.disableTimeRanges[f][1],b.disableTimeRanges[f-1][1])],b.disableTimeRanges.splice(f,1))}return b}function c(b){var e=b.data("timepicker-settings"),f=b.data("timepicker-list");if(f&&f.length&&(f.remove(),b.data("timepicker-list",!1)),e.useSelect)var n=f=d("<select />",{"class":"ui-timepicker-select"});else f=d("<ul />",{"class":"ui-timepicker-list"}),n=d("<div />",{"class":"ui-timepicker-wrapper",tabindex:-1}),n.css({display:"none",position:"absolute"}).append(f);if(e.noneOption)if(!0===e.noneOption&&(e.noneOption=e.useSelect?"Time...":"None"),d.isArray(e.noneOption))for(var a in e.noneOption){if(parseInt(a,10)==a){var c=h(e.noneOption[a],e.useSelect);f.append(c)}}else c=h(e.noneOption,e.useSelect),f.append(c);(e.className&&n.addClass(e.className),null===e.minTime&&null===e.durationTime||!e.showDuration)||("function"==typeof e.step?"function":e.step,n.addClass("ui-timepicker-with-duration"),n.addClass("ui-timepicker-step-"+e.step));c=e.minTime;"function"==typeof e.durationTime?c=m(e.durationTime()):null!==e.durationTime&&(c=e.durationTime);a=null!==e.minTime?e.minTime:0;var g=null!==e.maxTime?e.maxTime:a+q-1;a>g&&(g+=q);g===q-1&&"string"===d.type(e.timeFormat)&&e.show2400&&(g=q);var p=e.disableTimeRanges,l=0,z=p.length,v=e.step;"function"!=typeof v&&(v=function(){return e.step});for(var A=0;g>=a;A++,a+=60*v(A)){var u=a,y=x(u,e);if(e.useSelect)var t=d("<option />",{value:y});else t=d("<li />"),t.addClass(43200>u%86400?"ui-timepicker-am":"ui-timepicker-pm"),t.data("time",86400>=u?u:u%86400);t.text(y);if((null!==e.minTime||null!==e.durationTime)&&e.showDuration)if(y=F(a-c,e.step),e.useSelect)t.text(t.text()+" ("+y+")");else{var E=d("<span />",{"class":"ui-timepicker-duration"});E.text(" ("+y+")");t.append(E)}z>l&&(u>=p[l][1]&&(l+=1),p[l]&&u>=p[l][0]&&u<p[l][1]&&(e.useSelect?t.prop("disabled",!0):t.addClass("ui-timepicker-disabled")));f.append(t)}(n.data("timepicker-input",b),b.data("timepicker-list",n),e.useSelect)?(b.val()&&f.val(k(m(b.val()),e)),f.on("focus",function(){d(this).data("timepicker-input").trigger("showTimepicker")}),f.on("blur",function(){d(this).data("timepicker-input").trigger("hideTimepicker")}),f.on("change",function(){w(b,d(this).val(),"select")}),w(b,f.val(),"initial"),b.hide().after(f)):(a=e.appendTo,"string"==typeof a?a=d(a):"function"==typeof a&&(a=a(b)),a.append(n),B(b,f),f.on("mousedown click","li",function(e){b.off("focus.timepicker");b.on("focus.timepicker-ie-hack",function(){b.off("focus.timepicker-ie-hack");b.on("focus.timepicker",r.show)});C(b)||b[0].focus();f.find("li").removeClass("ui-timepicker-selected");d(this).addClass("ui-timepicker-selected");D(b)&&(b.trigger("hideTimepicker"),f.on("mouseup.timepicker click.timepicker","li",function(b){f.off("mouseup.timepicker click.timepicker");n.hide()}))}))}function h(b,e){var f,a,c;return"object"==typeof b?(f=b.label,a=b.className,c=b.value):"string"==typeof b?f=b:d.error("Invalid noneOption value"),e?d("<option />",{value:c,"class":a,text:f}):d("<li />",{"class":a,text:f}).data("time",String(c))}function k(b,e){return b=e.roundingFunction(b,e),null!==b?x(b,e):void 0}function p(b){b.target!=window&&(b=d(b.target),b.closest(".ui-timepicker-input").length||b.closest(".ui-timepicker-wrapper").length||(r.hide(),d(document).unbind(".ui-timepicker"),d(window).unbind(".ui-timepicker")))}function C(b){b=b.data("timepicker-settings");return(window.navigator.msMaxTouchPoints||"ontouchstart"in document)&&b.disableTouchKeyboard}function z(b,e,f){if(!f&&0!==f)return!1;b=b.data("timepicker-settings");var a=!1;f=b.roundingFunction(f,b);return e.find("li").each(function(b,e){var n=d(e);if("number"==typeof n.data("time"))return n.data("time")==f?(a=n,!1):void 0}),a}function B(b,e){e.find("li").removeClass("ui-timepicker-selected");var f=m(v(b),b.data("timepicker-settings"));if(null!==f&&(f=z(b,e,f))){var a=f.offset().top-e.offset().top;(a+f.outerHeight()>e.outerHeight()||0>a)&&e.scrollTop(e.scrollTop()+f.position().top-f.outerHeight());f.addClass("ui-timepicker-selected")}}function A(b,e){if(""!==this.value&&"timepicker"!=e){var f=d(this);if(!f.is(":focus")||b&&"change"==b.type){var a=f.data("timepicker-settings"),c=m(this.value,a);if(null===c)return void f.trigger("timeFormatError");var g=!1;null!==a.minTime&&c<a.minTime&&null!==a.maxTime&&c>a.maxTime&&(g=!0);d.each(a.disableTimeRanges,function(){return c>=this[0]&&c<this[1]?(g=!0,!1):void 0});a.forceRoundTime&&(c=a.roundingFunction(c,a));a=x(c,a);g?w(f,a,"error")&&f.trigger("timeRangeError"):w(f,a)}}}function v(b){return b.is("input")?b.val():b.data("ui-timepicker-value")}function w(b,a,f){if(b.is("input")){b.val(a);var e=b.data("timepicker-settings");e.useSelect&&"select"!=f&&"initial"!=f&&b.data("timepicker-list").val(k(m(a),e))}return b.data("ui-timepicker-value")!=a?(b.data("ui-timepicker-value",a),"select"==f?b.trigger("selectTime").trigger("changeTime").trigger("change","timepicker"):"error"!=f&&b.trigger("changeTime"),!0):(b.trigger("selectTime"),!1)}function G(b){switch(b.keyCode){case 13:case 9:break;default:b.preventDefault()}}function H(b){var a=d(this),f=a.data("timepicker-list");if(!f||!g(f)){if(40!=b.keyCode)return!0;r.show.call(a.get(0));f=a.data("timepicker-list");C(a)||a.focus()}switch(b.keyCode){case 13:return D(a)&&r.hide.apply(this),b.preventDefault(),!1;case 38:var c=f.find(".ui-timepicker-selected");return c.length?c.is(":first-child")||(c.removeClass("ui-timepicker-selected"),c.prev().addClass("ui-timepicker-selected"),c.prev().position().top<c.outerHeight()&&f.scrollTop(f.scrollTop()-c.outerHeight())):(f.find("li").each(function(b,a){return 0<d(a).position().top?(c=d(a),!1):void 0}),c.addClass("ui-timepicker-selected")),!1;case 40:return c=f.find(".ui-timepicker-selected"),0===c.length?(f.find("li").each(function(b,a){return 0<d(a).position().top?(c=d(a),!1):void 0}),c.addClass("ui-timepicker-selected")):c.is(":last-child")||(c.removeClass("ui-timepicker-selected"),c.next().addClass("ui-timepicker-selected"),c.next().position().top+2*c.outerHeight()>f.outerHeight()&&f.scrollTop(f.scrollTop()+c.outerHeight())),!1;case 27:f.find("li").removeClass("ui-timepicker-selected");r.hide();break;case 9:r.hide();break;default:return!0}}function I(b){var a=d(this),f=a.data("timepicker-list"),c=a.data("timepicker-settings");if(!f||!g(f)||c.disableTextInput)return!0;switch(b.keyCode){case 96:case 97:case 98:case 99:case 100:case 101:case 102:case 103:case 104:case 105:case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:case 65:case 77:case 80:case 186:case 8:case 46:c.typeaheadHighlight?B(a,f):f.hide()}}function D(b){var a=b.data("timepicker-settings"),f=null,c=b.data("timepicker-list").find(".ui-timepicker-selected");return c.hasClass("ui-timepicker-disabled")?!1:(c.length&&(f=c.data("time")),null!==f&&("string"!=typeof f&&(f=x(f,a)),w(b,f,"select")),!0)}function F(b,a){b=Math.abs(b);var f,c,e=Math.round(b/60),d=[];return 60>e?d=[e,l.mins]:(f=Math.floor(e/60),c=e%60,30==a&&30==c&&(f+=l.decimal+5),d.push(f),d.push(1==f?l.hr:l.hrs),30!=a&&c&&(d.push(c),d.push(l.mins))),d.join(" ")}function x(b,a){if("number"!=typeof b)return null;var c=parseInt(b%60);var e=parseInt(b/60%60);var g=parseInt(b/3600%24);g=new Date(1970,0,2,g,e,c,0);if(isNaN(g.getTime()))return null;if("function"===d.type(a.timeFormat))return a.timeFormat(g);for(var h="",k=0;k<a.timeFormat.length;k++)switch(e=a.timeFormat.charAt(k)){case "a":h+=11<g.getHours()?l.pm:l.am;break;case "A":h+=11<g.getHours()?l.PM:l.AM;break;case "g":e=g.getHours()%12;h+=0===e?"12":e;break;case "G":e=g.getHours();b===q&&(e=a.show2400?24:0);h+=e;break;case "h":e=g.getHours()%12;0!==e&&10>e&&(e="0"+e);h+=0===e?"12":e;break;case "H":e=g.getHours();b===q&&(e=a.show2400?24:0);h+=9<e?e:"0"+e;break;case "i":e=g.getMinutes();h+=9<e?e:"0"+e;break;case "s":c=g.getSeconds();h+=9<c?c:"0"+c;break;case "\\":k++;h+=a.timeFormat.charAt(k);break;default:h+=e}return h}function m(b,a){if(""===b||null===b)return null;if("object"==typeof b)return 3600*b.getHours()+60*b.getMinutes()+b.getSeconds();if("string"!=typeof b)return b;b=b.toLowerCase().replace(/[\s\.]/g,"");"a"!=b.slice(-1)&&"p"!=b.slice(-1)||(b+="m");var c="("+l.am.replace(".","")+"|"+l.pm.replace(".","")+"|"+l.AM.replace(".","")+"|"+l.PM.replace(".","")+")?",e=b.match(new RegExp("^"+c+"([0-9]?[0-9])\\W?([0-5][0-9])?\\W?([0-5][0-9])?"+c+"$"));if(!e)return null;c=parseInt(1*e[2],10);if(24<c){if(a&&!1===a.wrapHours)return null;c%=24}var d=e[1]||e[5],g=c;12>=c&&d&&(g=d==l.pm||d==l.PM,g=12==c?g?12:0:c+(g?12:0));e=3600*g+60*(1*e[3]||0)+(1*e[4]||0);12>c&&!d&&a&&a._twelveHourTime&&a.scrollDefault&&(c=e-a.scrollDefault(),0>c&&c>=q/-2&&(e=(e+q/2)%q));return e}var q=86400,l={am:"am",pm:"pm",AM:"AM",PM:"PM",decimal:".",mins:"mins",hr:"hr",hrs:"hrs"},r={init:function(b){return this.each(function(){var e=d(this),f=[],g;for(g in d.fn.timepicker.defaults)e.data(g)&&(f[g]=e.data(g));f=d.extend({},d.fn.timepicker.defaults,f,b);if(f.lang&&(l=d.extend(l,f.lang)),f=a(f),e.data("timepicker-settings",f),e.addClass("ui-timepicker-input"),f.useSelect)c(e);else{if(e.prop("autocomplete","off"),f.showOn)for(var h in f.showOn)e.on(f.showOn[h]+".timepicker",r.show);e.on("change.timepicker",A);e.on("keydown.timepicker",H);e.on("keyup.timepicker",I);f.disableTextInput&&e.on("keydown.timepicker",G);A.call(e.get(0))}})},show:function(b){var a=d(this),f=a.data("timepicker-settings");if(b&&b.preventDefault(),f.useSelect)return void a.data("timepicker-list").focus();C(a)&&a.blur();b=a.data("timepicker-list");if(!a.prop("readonly")&&(b&&0!==b.length&&"function"!=typeof f.durationTime||(c(a),b=a.data("timepicker-list")),!g(b))){a.data("ui-timepicker-value",a.val());B(a,b);r.hide();b.show();var h={};f.orientation.match(/r/)?h.left=a.offset().left+a.outerWidth()-b.outerWidth()+parseInt(b.css("marginLeft").replace("px",""),10):h.left=a.offset().left+parseInt(b.css("marginLeft").replace("px",""),10);"t"==(f.orientation.match(/t/)?"t":f.orientation.match(/b/)?"b":a.offset().top+a.outerHeight(!0)+b.outerHeight()>d(window).height()+d(window).scrollTop()?"t":"b")?(b.addClass("ui-timepicker-positioned-top"),h.top=a.offset().top-b.outerHeight()+parseInt(b.css("marginTop").replace("px",""),10)):(b.removeClass("ui-timepicker-positioned-top"),h.top=a.offset().top+a.outerHeight()+parseInt(b.css("marginTop").replace("px",""),10));b.offset(h);h=b.find(".ui-timepicker-selected");if(!h.length){var k=m(v(a));null!==k?h=z(a,b,k):f.scrollDefault&&(h=z(a,b,f.scrollDefault()))}h&&h.length?(h=b.scrollTop()+h.position().top-h.outerHeight(),b.scrollTop(h)):b.scrollTop(0);return f.stopScrollPropagation&&d(document).on("wheel.ui-timepicker",".ui-timepicker-wrapper",function(b){b.preventDefault();var a=d(this).scrollTop();d(this).scrollTop(a+b.originalEvent.deltaY)}),d(document).on("touchstart.ui-timepicker mousedown.ui-timepicker",p),d(window).on("resize.ui-timepicker",p),f.closeOnWindowScroll&&d(document).on("scroll.ui-timepicker",p),a.trigger("showTimepicker"),this}},hide:function(b){b=d(this);var a=b.data("timepicker-settings");return a&&a.useSelect&&b.blur(),d(".ui-timepicker-wrapper").each(function(){var b=d(this);if(g(b)){var a=b.data("timepicker-input"),c=a.data("timepicker-settings");c&&c.selectOnBlur&&D(a);b.hide();a.trigger("hideTimepicker")}}),this},option:function(b,e){return"string"==typeof b&&"undefined"==typeof e?d(this).data("timepicker-settings")[b]:this.each(function(){var f=d(this),g=f.data("timepicker-settings"),h=f.data("timepicker-list");"object"==typeof b?g=d.extend(g,b):"string"==typeof b&&(g[b]=e);g=a(g);f.data("timepicker-settings",g);h&&(h.remove(),f.data("timepicker-list",!1));g.useSelect&&c(f)})},getSecondsFromMidnight:function(){return m(v(this))},getTime:function(b){var a=v(this);if(!a)return null;a=m(a);if(null===a)return null;b||(b=new Date);b=new Date(b);return b.setHours(a/3600),b.setMinutes(a%3600/60),b.setSeconds(a%60),b.setMilliseconds(0),b},isVisible:function(){var a=this.data("timepicker-list");return!(!a||!g(a))},setTime:function(a){var b=this.data("timepicker-settings");var c=b.forceRoundTime?k(m(a),b):x(m(a),b);return a&&null===c&&b.noneOption&&(c=a),w(this,c),this.data("timepicker-list")&&B(this,this.data("timepicker-list")),this},remove:function(){if(this.hasClass("ui-timepicker-input")){var a=this.data("timepicker-settings");return this.removeAttr("autocomplete","off"),this.removeClass("ui-timepicker-input"),this.removeData("timepicker-settings"),this.off(".timepicker"),this.data("timepicker-list")&&this.data("timepicker-list").remove(),a.useSelect&&this.show(),this.removeData("timepicker-list"),this}}};d.fn.timepicker=function(a){return this.length?r[a]?this.hasClass("ui-timepicker-input")?r[a].apply(this,Array.prototype.slice.call(arguments,1)):this:"object"!=typeof a&&a?void d.error("Method "+a+" does not exist on jQuery.timepicker"):r.init.apply(this,arguments):this};d.fn.timepicker.defaults={appendTo:"body",className:null,closeOnWindowScroll:!1,disableTextInput:!1,disableTimeRanges:[],disableTouchKeyboard:!1,durationTime:null,forceRoundTime:!1,maxTime:null,minTime:null,noneOption:!1,orientation:"l",roundingFunction:function(a,c){if(null===a)return null;if("number"!=typeof c.step)return a;var b=a%(60*c.step);return b>=30*c.step?a+=60*c.step-b:a-=b,a==q&&c.show2400?a:a%q},scrollDefault:null,selectOnBlur:!1,show2400:!1,showDuration:!1,showOn:["click","focus"],showOnFocus:!0,step:30,stopScrollPropagation:!1,timeFormat:"g:ia",typeaheadHighlight:!0,useSelect:!1,wrapHours:!0}});var v_oActEvent=null;$(document).ready(function(){CalendarInit($("#datepicker"),DaySelect);$("body").on("click",".adm-dayevents-tools-newbt",function(d){ClearContent(d)&&CreateEvent($("#datepicker").datepicker("getDate"),$(".adm-day-conn"),function(d){v_oActEvent=d})});$("body").on("click",".seltimebt",function(d){var g=$(this).parent(".timeinput"),a=$(this);d.preventDefault();a.is(".wait")||g.find("input[type=text]").timepicker({timeFormat:"H:i",scrollDefault:"now"}).on("hideTimepicker",function(){$(this).timepicker("remove");a.addClass("wait");setTimeout(function(){a.removeClass("wait")},400)}).on("showTimepicker",function(){$(".ui-timepicker-wrapper").css({left:$(this).position().left-4})}).timepicker("show")});$("body").on("click",".adm-dayevents-view .event:not(.selected)",function(d){ClearContent(d)&&OpenEvent($(this).attr("pk"),function(d){v_oActEvent=d})});$("body").on("click",".ajaxsubmit",function(d){ProcessGeneralAjaxSubmit($(this),d)});$("body").on("click",".adm-newregconn-conn .new_registration",function(){var d=$(this);OpenRegistration($(this).attr("pk"),$(this).attr("courpk"),$(this).attr("date"),function(){d.mouseover()})});$("body").on("mouseover",".adm-newregconn-conn .new_registration",function(){$(this).css({background:"rgba(220,250,255,1)"});$('.adm-dayevents-view .event[pk="'+$(this).attr("courpk")+'"]').addClass("selhover");$('.registrationconn .registration[pk="'+$(this).attr("pk")+'"] .header').addClass("selhover")});$("body").on("mouseleave",".adm-newregconn-conn .new_registration",function(){$(this).css({background:"rgb(245, 245, 100)"});$('.adm-dayevents-view .event[pk="'+$(this).attr("courpk")+'"]').removeClass("selhover");$('.registrationconn .registration[pk="'+$(this).attr("pk")+'"] .header').removeClass("selhover")});$("body").on("mouseenter",".adm-dayevents-view .event",function(){$(this).addClass("selhover");$('.adm-newregconn-conn .new_registration[courpk="'+$(this).attr("pk")+'"]').css({background:"rgba(220,250,255,1)"})});$("body").on("mouseleave",".adm-dayevents-view .event",function(){$(this).removeClass("selhover");$('.adm-newregconn-conn .new_registration[courpk="'+$(this).attr("pk")+'"]').css({background:"rgb(245, 245, 100)"})});$("body").on("mouseenter",".registrationconn .registration .header",function(){$(this).addClass("selhover");$('.adm-newregconn-conn .new_registration[pk="'+$(this).closest(".registration").attr("pk")+'"]').css({background:"rgba(220,250,255,1)"})});$("body").on("mouseleave",".registrationconn .registration .header",function(){$(this).removeClass("selhover");$('.adm-newregconn-conn .new_registration[pk="'+$(this).closest(".registration").attr("pk")+'"]').css({background:"rgb(245, 245, 100)"})});GetNavigation();GetNewRegistrations();setInterval(UpdateActStatus,1E4)});var CalendarDataXML="";function CalendarInit(d,g,a){$.datepicker.regional.cs={closeText:"Cerrar",prevText:"<",nextText:">",currentText:"Hoy",monthNames:"Leden \u00danor B\u0159ezen Duben Kv\u011bten \u010cerven \u010cervenec Srpen Z\u00e1\u0159\u00ed \u0158\u00edjen Listopad Prosinec".split(" "),monthNamesShort:"Leden \u00danor B\u0159ezen Duben Kv\u011bten \u010cerven \u010cervenec Srpen Z\u00e1\u0159\u00ed \u0158\u00edjen Listopad Prosinec".split(" "),dayNames:"Ned\u011ble Pond\u011bl\u00ed \u00dater\u00fd St\u0159eda \u010ctvrtek P\u00e1tek Sobota".split(" "),dayNamesShort:"Ne Po \u00dat St \u010ct P\u00e1 So".split(" "),dayNamesMin:"Ne Po \u00dat St \u010ct P\u00e1 So".split(" "),weekHeader:"Sm",dateFormat:"dd.mm.yy",firstDay:1,isRTL:!0,showMonthAfterYear:!1,yearSuffix:"",showOtherMonths:!0,selectOtherMonths:!0,numberOfMonths:1,changeMonth:!0,changeYear:!0,showButtonPanel:!1};$.datepicker.setDefaults($.datepicker.regional.cs);var c=new Date,h=c.getMonth(),k=new Date(c.getFullYear(),h-1,1);c=new Date(c.getFullYear(),h+2,0);RequestCalendarhData(!1,k,c);d.datepicker({afterShow:function(a,c,d){$(this).find(".ui-datepicker-title").append('<button class="today">Dnes</button>');AfterLoadDays($(this),CalendarDataXML)},onSelect:function(a){"function"===typeof g&&g($(this),a)},onChangeMonthYear:function(c,d){RequestCalendarhData(!1,new Date(c,d-2,1),new Date(c,d+1,1),function(){"function"===typeof a&&a(c,d)})}}).on("click","button.today",function(){g(d,DateToStr(new Date))})}function AfterLoadDays(d,g){d.find("table td").each(function(){var a=parseInt($(this).find("*").text()),c=parseInt($(this).attr("data-month")),d=parseInt($(this).attr("data-year"));a=new Date(d,c,a);var k=$(g).find('day[date="'+DateToStr(a)+'"]');c='<div class="ondaydata">';if(0<k.length){d=parseInt(k.find('event[state="open"]').size());var p=parseInt(k.find('event[state="hidden"]').size());k=parseInt(k.find('event[state="full"]').size());0<d&&(c=c+'<div class="open-event-color">'+d+"</div>");0<k&&(c=c+'<div class="full-event-color">'+k+"</div>");0<p&&(c=c+'<div class="hidden-event-color">'+p+"</div>")}c+="</div>";0<$('.adm-newregconn .new_registration[date="'+DateToStr(a)+'"]').length&&$(this).css({backgroundColor:"rgb(250,250,0)"}).addClass("hasnew");$(c).appendTo($(this))})}function RequestCalendarhData(d,g,a,c){SendAjaxRequest("type=GetCalendarData&fromdate="+DateToStr(g)+"&todate="+DateToStr(a),d,function(a){CalendarDataXML=$(a).html();"function"==typeof c&&c(a)})}var v_aOpenRegStatus=[],Registration=function(d,g){this.i_oObjResponse=g;this.i_oParentEvent=d;this.i_oHTMLObj=null;this.i_sPK="";this.i_bClosed=!0;this.i_bIsNew=!1;this.ProcessState=function(){this.i_oHTMLObj=null;var a=this;a.i_sPK=a.i_oObjResponse.find("primary_key").text();a.i_bClosed="0"===a.i_oObjResponse.find("isopendetail").text();this.i_oObjResponse.find("> actions action").each(function(){switch($(this).text()){case "Close":a.Close();break;case "ShowHtml":a.ShowHTML();break;case "InitNewForm":case "InitEditForm":case "InitOverViewActions":a.InitBaseAjaxSubmit()}})};this.ShowHTML=function(){var a=this;this.i_oParentEvent.i_oHTMLObj&&(this.i_oHTMLObj=$(this.i_oObjResponse.find("> showhtml").html()).appendTo(this.i_oParentEvent.i_oHTMLObj.find(".registrationconn")),this.i_oObjResponse.find("> invaliddata > input").each(function(){HighlightInvalInput($(this).attr("name"),$(this).attr("message"),a.i_oHTMLObj)}),this.i_oHTMLObj.attr("pk",this.i_sPK),"1"==this.i_oHTMLObj.attr("isnew")&&(this.i_bIsNew=!0,this.i_oHTMLObj.find(".header").append('<div class="newtag">nov\u00e1</div>')));if(this.i_oHTMLObj.hasClass("noclose"))v_aOpenRegStatus[this.i_sPK]="open";else{this.i_bClosed||(v_aOpenRegStatus[this.i_sPK]="open");var c=v_aOpenRegStatus[this.i_sPK];"closed"===c||"open"!==c?(this.i_bClosed=!0,this.CloseDetail(0)):this.i_bClosed=!1;this.i_oHTMLObj.find(".header").click(function(){a.i_bClosed?a.OpenDetail():a.CloseDetail()})}};this.InitBaseAjaxSubmit=function(){var a=this;this.i_oHTMLObj.on("click",".ajaxsubmit",function(c){c.stopPropagation();c.preventDefault();if("delete"===$(this).attr("ajaxtype"))a.i_oParentEvent.DeleteRegistration(a.i_sPK);else{c=a.i_oHTMLObj.find("form");var d=$(this).attr("data");a.SendAjax($(this).attr("ajaxtype"),(c?c.serialize():"")+(d?"&"+d:""))}})};this.Close=function(){null!==this.i_oHTMLObj&&this.i_oHTMLObj.remove()};this.SendAjax=function(a,c){this.i_oParentEvent.SendAjax("RegistrationAjax","RegistrationAxajType="+a+"&RegistrationPK="+this.i_sPK+(""!==c?"&"+c:""))};this.InitDeleteForm=function(a){CreateDeleteConfirm(this.i_oHTMLObj.find(".header"),"Opravdu si p\u0159ejete vymazat registraci?",a)};this.ReadNewRegistration=function(a){var c=this;setTimeout(function(){c.i_oHTMLObj.find(".newtag").fadeOut(500,function(){c.SendAjax("readnew")});var a=$(".adm-newregconn-conn .new_registration[pk="+c.i_sPK+"]");a.slideUp(500,function(){a.remove();$(".newregcount").text($(".adm-newregconn-conn .new_registration").size());0==$('.adm-newregconn-conn .new_registration[date="'+a.attr("date")+'"]').size()&&GetCalenDayTDByDate(StrToDate(a.attr("date")),".hasnew").animate({backgroundColor:"rgb(255,255,255)"},300,"swing",function(){$(this).removeClass("hasnew")})})},1E3);"function"==typeof a&&a()};this.OpenDetail=function(a,c){a=void 0===a?250:a;var d=this;this.i_oHTMLObj.find(".content").slideDown(a,function(){d.i_bClosed=!1;v_aOpenRegStatus[d.i_sPK]="open";d.i_bIsNew?d.ReadNewRegistration(c):"function"==typeof c&&c()})};this.CloseDetail=function(a,c){a=void 0===a?250:a;var d=this;this.i_oHTMLObj.find(".content").slideUp(a,function(){d.i_bClosed=!0;v_aOpenRegStatus[d.i_sPK]="closed";"function"==typeof c&&c()})}};function CreateEvent(d,g,a){SendAjaxRequest("type=CreateEvent&date="+DateToStr(d),!0,function(c){ClearContent()&&(c=new Event($(".adm-day-conn"),$(c).find("> object_response")),c.ProcessState(),"function"==typeof a&&a(c))})}function OpenEvent(d,g){SendAjaxRequest("type=OpenEvent&pk="+d,!0,function(a){ClearContent()&&(a=new Event($(".adm-day-conn"),$(a).find("> object_response")),a.ProcessState(),"function"==typeof g&&g(a))})}function DeleteEvent(){SendAjaxRequest("type=DeleteEvent",!0,function(d){0<$(d).find("error").length?(new Event($(".adm-day-conn"),$(d).find("> object_response"))).ProcessState():(ClearContent(),ReloadData())})}function CloseEvent(d){ClearContent()&&SendAjaxRequest("type=CloseEvent",!0,function(g){"function"==typeof d&&d(g)})}function SelectFromOverview(d){$(".adm-dayevents-view .event").removeClass("selected");$(".adm-dayevents-view .event[pk="+d+"]").addClass("selected")}var Event=function(d,g){this.i_oObjResponse=g;this.i_oParent=d;this.i_oHTMLObj=null;this.i_sPK="";this.i_aRegistrations=[];this.ProcessState=function(){var a=this;this.i_aRegistrations=[];this.i_sPK=this.i_oObjResponse.find("> primary_key").text();if("1"===this.i_oObjResponse.attr("reload"))this.i_oObjResponse.attr("reload","0"),ReloadData(function(){a.ProcessState()});else{SelectFromOverview(this.i_sPK);var c=!1;this.i_oObjResponse.find("> actions action").each(function(){switch($(this).text()){case "DoNothing":return c=!0,!1;case "Close":a.Close();break;case "ShowHtml":a.ShowHTML();break;case "CantAddNew":CreateConfirm(a.i_oHTMLObj.find(".registarationcaption"),"warning","Nen\u00ed mo\u017en\u00e9 p\u0159id\u00e1vat dal\u0161\u00ed registrace, kapacita byla napln\u011bna.",[{submit:!1,message:"ok"}]);break;case "InitNewForm":case "InitEditForm":case "InitOverViewActions":a.InitBaseAjaxSubmit()}});c||(a.i_oObjResponse.find("> registrations > registration").each(function(){a.AddRegistration($(this).find("> object_response"))}),this.ProcessRegistrations())}};this.ShowHTML=function(){null!==this.i_oHTMLObj&&this.i_oHTMLObj.remove();var a=this;this.i_oHTMLObj=$(this.i_oObjResponse.find("> showhtml").html()).appendTo(this.i_oParent);this.i_oObjResponse.find("> invaliddata > input").each(function(){HighlightInvalInput($(this).attr("name"),$(this).attr("message"),a.i_oHTMLObj)})};this.SendAjax=function(a,c){var d=this;SendAjaxRequest("type=EventAjax&EventAjaxType="+a+(""!==c?"&"+c:""),!0,function(a){d.i_oObjResponse=$(a).find("> object_response");d.ProcessState()})};this.Close=function(){CloseEvent()};this.Update=function(){this.SendAjax("Update")};this.InitBaseAjaxSubmit=function(){var a=this;this.i_oHTMLObj.on("click",".ajaxsubmit",function(c){c.stopPropagation();c.preventDefault();if("delete"===$(this).attr("ajaxtype"))CreateDeleteConfirm(a.i_oHTMLObj.find(".caption").eq(0),"Opravdu si p\u0159ejete vymazat ud\u00e1lost?",DeleteEvent);else{c=a.i_oHTMLObj.find("form");var d=$(this).attr("data");a.SendAjax($(this).attr("ajaxtype"),(c?"&"+c.serialize():"")+(d?"&"+d:""))}})};this.DeleteRegistration=function(a){for(var c=0;c<this.i_aRegistrations.length;c++)if(this.i_aRegistrations[c].i_sPK===a){var d=this,g=this.i_aRegistrations[c];g.InitDeleteForm(function(){g.i_oHTMLObj.slideUp(200,function(){d.SendAjax("deletegistration","RegistrationPK="+g.i_sPK)})});break}};this.AddRegistration=function(a){a=new Registration(this,a);this.i_aRegistrations.push(a)};this.ProcessRegistrations=function(){for(var a=0;a<this.i_aRegistrations.length;a++)this.i_aRegistrations[a].ProcessState()};this.GetRegistrationByPK=function(a){for(var c=0;c<this.i_aRegistrations.length;c++)if(this.i_aRegistrations[c].i_sPK==a)return this.i_aRegistrations[c];return null}};function DaySelect(d,g,a){ClearContent();d.datepicker("setDate",g);$(".daydate").text(g);LoadEventsOnDay(g,a)}function LoadEventsOnDay(d,g){SendAjaxRequest("type=SelectDay&date="+d,!0,function(a){$(".adm-dayevents-view").empty();var c="";$(a).find("event_html")?$(a).find("event_html").each(function(){c='<div class="event" pk="'+$(this).attr("pk")+'" state="'+$(this).attr("state")+'">'+$(this).html()+"</div>";$(c).appendTo(".adm-dayevents-view")}):(c='<div class="adm-dayevents-view-nodata">\u017d\u00e1dn\u00e1 data</div>',$(c).appendTo(".adm-dayevents-view"));"function"==typeof g&&g()})}function ClearContent(d){var g=!0;0<$(".adm-day-conn .checkbeforeclose").length&&(g=confirm("P\u0159ejete si opravdu opustit neulo\u017een\u00fd formul\u00e1\u0159 ?"));g?($(".adm-day-conn").empty(),v_oActEvent=null,SelectFromOverview("0")):d&&d.stopPropagation();return g}function GetNavigation(){SendAjaxRequest("type=GetNavigation",!0,function(d){var g=$(d).find("actday").text();DaySelect($("#datepicker"),g,function(){var a=$(d).find("openevent > object_response"),c=$(d).find("openpage");0<a.length?(v_oActEvent=new Event($(".adm-day-conn"),$(d).find("openevent > object_response")),v_oActEvent.ProcessState()):0<c.length&&new ResponsivePage($(".adm-day-conn"),c.html())})})}function ReloadData(d){var g=$("#datepicker").datepicker("getDate"),a=g.getFullYear(),c=g.getMonth();RequestCalendarhData(!0,new Date(a,c-1,1),new Date(a,c+1,1),function(){DaySelect($("#datepicker"),DateToStr(g),d)})}function ProcessGeneralAjaxSubmit(d,g,a){g.stopPropagation();g.preventDefault();g=d.closest("form");a=d.attr("data");SendAjaxRequest("type="+d.attr("ajaxtype")+(g?"&"+g.serialize():"")+(a?"&"+a:""),!0,function(a){$(a).find("general_response").find("actions action").each(function(){switch($(this).text()){case "NewResponsivePage":new ResponsivePage($(".adm-day-conn"),$(a).find("general_response pagedata").html())}})})}function UpdateActStatus(){GetNewRegistrations(function(){UpdateCalendatData(function(){null!=v_oActEvent&&v_oActEvent.Update()})})}function UpdateCalendatData(d){var g=$("#datepicker"),a=g.datepicker("getDate"),c=DateToStr(a),h=a.getFullYear();a=a.getMonth();RequestCalendarhData(!0,new Date(h,a-2,1),new Date(h,a+1,1),function(){g.datepicker("setDate",c);LoadEventsOnDay(c,function(){"function"==typeof d&&d()})})}var ResponsivePage=function(d,g){this.i_oParent=d;this.i_oHmltObj=null;this.ProcessPageResponse=function(a){var c=$("<elem>"+a+"</elem>").find("page_response"),d=this;"1"===c.attr("reload")?(c.attr("reload","0"),ReloadData(function(){d.ProcessPageResponse()})):c.find("> actions action").each(function(){switch($(this).text()){case "Close":d.Close();break;case "ShowHtml":d.ShowHTML(c.find("showhtml").html()),c.find("> invaliddata > input").each(function(){HighlightInvalInput($(this).attr("name"),$(this).attr("message"),d.i_oHTMLObj)})}})};this.ShowHTML=function(a){ClearContent()&&(this.i_oHTMLObj=$(a).appendTo(this.i_oParent),this.InitBaseAjaxSubmit())};this.Close=function(){ClearContent()&&this.SendAjax("Close","",function(){})};this.SendAjax=function(a,c,d){var g=this;SendAjaxRequest("type=RespPageAjax&RespPageAjaxType="+a+(""!==c?c:""),!0,function(a){g.ProcessPageResponse(a);"function"===typeof d&&d()})};this.InitBaseAjaxSubmit=function(){var a=this;this.i_oHTMLObj.on("click",".ajaxsubmit",function(c){c.stopPropagation();c.preventDefault();c=$(this).closest("form");var d=$(this).attr("data");a.SendAjax($(this).attr("ajaxtype"),(c?"&"+c.serialize():"")+(d?"&"+d:""))})};this.ProcessPageResponse(g)};function GetNewRegistrations(d){var g=$(".adm-newregconn");SendAjaxRequest("type=GetNewRegistrations",!0,function(a){var c=!1;$(a).find("registration").each(function(a){var d=BuildRegistrationObj($(this));0==g.find('.new_registration[pk="'+d.attr("pk")+'"]').size()&&(c=!0,d.css({background:"rgb(245,245,100)"}).hide(),d.appendTo(g.find(".adm-newregconn-conn")),setTimeout(function(){d.toggle("slide",{direction:"right"})},150+70*a),a=GetCalenDayTDByDate(StrToDate($(this).attr("courdate")),":not(hasnew)"),null!=a&&a.animate({backgroundColor:"rgb(250,250,0)"},300,"swing",function(){$(this).addClass("hasnew")}))});$(".newregcount").text($(".adm-newregconn-conn .new_registration").size());c&&"function"==typeof d&&d()})}function BuildRegistrationObj(d){var g='<div class="new_registration" pk="'+d.attr("pk")+'" courpk="'+d.attr("courpk")+'" date="'+d.attr("courdate")+'">';g+='<div class="term">'+d.attr("courdatetime")+"</div><table><tr><td>Jm\u00e9no:</td><td>"+d.attr("firstname")+" "+d.attr("lastname")+"</td></tr><tr><td>Kurz:</td><td>"+d.attr("language")+" - "+d.attr("courname")+'</td></tr></table><div class="created"><span>Vytvo\u0159eno:</span><span>'+d.attr("created")+"</span></div></div>";return $(g)}function GetCalenDayTDByDate(d,g){var a=null;$("#datepicker").find('table tbody td[data-month="'+d.getMonth()+'"][data-year="'+d.getFullYear()+'"]'+g).each(function(){$(this).find("a").text()==d.getDate()&&(a=$(this))});return a}function OpenRegistration(d,g,a,c){var h=function(){OpenEvent(g,function(a){a.GetRegistrationByPK(d).OpenDetail(250,c)})},k=$("#datepicker");k.datepicker("getDate")!=StrToDate(a)?DaySelect(k,a,h):h()};